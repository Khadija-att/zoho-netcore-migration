void automation.SandboxCPTaggingStatusChanged(Int propertyID,String propertyHistory)
{
info "Property ID: " + propertyID;
info "propertyHistory: " + propertyHistory;
previousStatus = ifnull(propertyHistory.get("CP_Tagging_Status"),"");
info previousStatus;
if(previousStatus == null || previousStatus == "")
{
	return;
}
propertyData = zoho.crm.getRecordById("Products",propertyID);
if(propertyData == null)
{
	info "No Property found for ID: " + propertyID;
	return;
}
currentStatus = ifnull(propertyData.get("CP_Tagging_Status"),"");
info "Previous Status: " + previousStatus;
info "Current Status: " + currentStatus;
propertyIdStr = propertyID.toString();
webhookPayload = Map();
webhookPayload.put("Property_Id",propertyIdStr);
webhookPayload.put("Property_Name",propertyData.get("Product_Name"));
webhookPayload.put("Property_Source",propertyData.get("Source"));
webhookPayload.put("Property_Status",propertyData.get("Status"));
webhookPayload.put("Unit_Number",propertyData.get("Unit"));
owner = propertyData.get("Owner");
webhookPayload.put("Truva_RM",owner.get("name"));
webhookPayload.put("Property_Priority",propertyData.get("Priority"));
webhookPayload.put("Property_Category",propertyData.get("Product_Category"));
webhookPayload.put("previous_status",previousStatus);
webhookPayload.put("new_status",currentStatus);
webhookPayload.put("activity_name","cp_tagging_Status_changed");
webhookPayload.put("User_Type","Property");
Channel_Partner = propertyData.get('Account_Name');
if(Channel_Partner != null)
{
	if(Channel_Partner.containKey("id"))
	{
		cpId = Channel_Partner.get("id");
		cpDetails = zoho.crm.getRecordById("Accounts",cpId);
		if(cpDetails != null)
		{
			webhookPayload.put("cp_name",cpDetails.get("Contact_name"));
			webhookPayload.put("cp_number",cpDetails.get("Phone"));
		}
	}
}
webhookPayload.put("Tower",null);
webhookPayload.put("Society",null);
webhookPayload.put("Township",null);
towerLookup = propertyData.get("Tower");
info towerLookup;
info "Tower lookup raw value: " + towerLookup;
if(towerLookup != null && towerLookup != "")
{
	if(towerLookup.containKey("id"))
	{
		towerId = towerLookup.get("id");
		towerDetails = zoho.crm.getRecordById("Towers",towerId);
		info "Tower Details: " + towerDetails;
		if(towerDetails != null)
		{
			webhookPayload.put("Tower",towerDetails.get("Name"));
			webhookPayload.put("Society",towerDetails.get("Society"));
			webhookPayload.put("Township",towerDetails.get("Township"));
		}
	}
}
info webhookPayload;
apiendpoint = "https://qqvnbapdea.execute-api.ap-south-1.amazonaws.com/prod/sandbox-netcore-event";
resp = invokeurl
[
	url :apiendpoint
	type :POST
	parameters:webhookPayload.toString()
	headers:{"Content-Type":"application/json"}
];
info "API Gateway response: " + resp;
}